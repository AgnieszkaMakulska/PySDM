language: shell

jobs:
  include:
    - name: "nightly Python build with newest packages on Linux"
      python: "nightly"
      before_install:
        - sudo python3 -m pip install --upgrade pip
      after_install:
        - python3 -m pip install -U $(pip freeze | cut -d '=' -f 1)
    - name: "Python 3.7 on Linux"
      python: 3.7
    - name: "Python 3.7 on OSX"
      os: osx
    - name: "Python 3.7 on Windows"
      os: windows
      before_install:
        - choco install python --version 3.7
        - python3 -m pip install --upgrade pip
      env: PATH=/c/Python37:/c/Python37/Scripts:$PATH

install:
  - python3 -m pip install -U -r requirements.txt
  - python3 -m pip install -r submodules/MPyDATA/requirements.txt
  - python3 -m pip install submodules/MPyDATA

script:
  - python3 -m pytest --ignore submodules --cov-report term --cov=PySDM
  - |
      python3 -m ipykernel install --user
      for i in PySDM_examples/*/demo.ipynb; do
         jupyter nbconvert --to markdown --stdout $i > $i.md.repo;
         jupyter nbconvert --ExecutePreprocessor.timeout=1800 --to markdown --execute --stdout $i > $i.md.travis;
         # diff $i.md.repo $i.md.travis  # does not make sense with ipywidgets
      done;
  - |
      for i in PySDM_examples/*/example.py; do
        PYTHONPATH=. python3 $i
      done;

after_success:
  - codecov
